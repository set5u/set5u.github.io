const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Dr010rql.js","./CR__Ohlt.js","./entry.DOTVMxzP.css","./B-pl63Pz.js"])))=>i.map(i=>d[i]);
import{a1 as q}from"./CR__Ohlt.js";import"./B-pl63Pz.js";import{L as ne,aM as te,V as p,cd as ae,ak as oe,ce as ie,ae as le,cf as se}from"./Dr010rql.js";function Q(e,t,a,r,n,i,o){try{var s=e[i](o),u=s.value}catch(l){a(l);return}s.done?t(u):Promise.resolve(u).then(r,n)}function ue(e){return function(){var t=this,a=arguments;return new Promise(function(r,n){var i=e.apply(t,a);function o(u){Q(i,r,n,o,s,"next",u)}function s(u){Q(i,r,n,o,s,"throw",u)}o(void 0)})}}function fe(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function ce(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{},r=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(n){return Object.getOwnPropertyDescriptor(a,n).enumerable}))),r.forEach(function(n){fe(e,n,a[n])})}return e}function pe(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a.push.apply(a,r)}return a}function de(e,t){return t=t??{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):pe(Object(t)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}),e}function ye(e,t){var a,r,n,i,o={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function s(l){return function(f){return u([l,f])}}function u(l){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,r&&(n=l[0]&2?r.return:l[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,l[1])).done)return n;switch(r=0,n&&(l=[l[0]&2,n.value]),l[0]){case 0:case 1:n=l;break;case 4:return o.label++,{value:l[1],done:!1};case 5:o.label++,r=l[1],l=[0];continue;case 7:l=o.ops.pop(),o.trys.pop();continue;default:if(n=o.trys,!(n=n.length>0&&n[n.length-1])&&(l[0]===6||l[0]===2)){o=0;continue}if(l[0]===3&&(!n||l[1]>n[0]&&l[1]<n[3])){o.label=l[1];break}if(l[0]===6&&o.label<n[1]){o.label=n[1],n=l;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(l);break}n[2]&&o.ops.pop(),o.trys.pop();continue}l=t.call(e,o)}catch(f){l=[6,f],r=0}finally{a=n=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}var K="image/png",X=2,Z=[134,22,135,150,246,214,150,54];function be(e){for(var t=new DataView(e.buffer,e.byteOffset,e.byteLength),a=0,r=0;r<Z.length;r++)if(t.getUint8(a++)!==Z[r])return ne.Error("Not a babylon environment map"),null;for(var n="",i=0;i=t.getUint8(a++);)n+=String.fromCharCode(i);var o=JSON.parse(n);return o=M(o),o.specular&&(o.specular.specularDataPosition=a,o.specular.lodGenerationScale=o.specular.lodGenerationScale||.8),o}function M(e){if(e.version>X)throw new Error('Unsupported babylon environment map version "'.concat(e.version,'". Latest supported version is "').concat(X,'".'));return e.version===2||(e=de(ce({},e),{version:2,imageType:K})),e}function me(e,t){t=M(t);var a=t.specular,r=Math.log2(t.width);if(r=Math.round(r)+1,a.mipmaps.length!==6*r)throw new Error('Unsupported specular mipmaps number "'.concat(a.mipmaps.length,'"'));for(var n=new Array(r),i=0;i<r;i++){n[i]=new Array(6);for(var o=0;o<6;o++){var s=a.mipmaps[i*6+o];n[i][o]=new Uint8Array(e.buffer,e.byteOffset+a.specularDataPosition+s.position,s.length)}}return n}function ve(e,t,a){a=M(a);var r=a.specular;if(!r)return Promise.resolve();e._lodGenerationScale=r.lodGenerationScale;var n=me(t,a);return j(e,n,a.imageType)}function $(e,t,a,r,n,i,o,s,u,l,f){return new Promise(function(c,b){if(a){var g=t.createTexture(null,!0,!0,null,1,null,function(y){b(y)},e);r==null||r.onEffectCreatedObservable.addOnce(function(y){y.executeWhenCompiled(function(){r.externalTextureSamplerBinding=!0,r.onApply=function(d){d._bindTexture("textureSampler",g),d.setFloat2("scale",1,t._features.needsInvertingBitmap&&e instanceof ImageBitmap?-1:1)},t.scenes.length&&(t.scenes[0].postProcessManager.directRender([r],l,!0,i,o),t.restoreDefaultFramebuffer(),g.dispose(),URL.revokeObjectURL(n),c())})})}else{if(t._uploadImageToTexture(f,e,i,o),s){var v=u[o];v&&t._uploadImageToTexture(v._texture,e,i,0)}c()}})}function j(e,t){return k.apply(this,arguments)}function k(){return k=ue(function(e,t){var a,r,n,i,o,s,u,l,f,c,b,g,v,y,d,V,H,S,I,Y,N,_,m,D,O,T,F,A,R,x,P=arguments;return ye(this,function(w){switch(w.label){case 0:if(a=function(h){for(var ee=function(U){var re=t[h][U],W=new Blob([re],{type:r}),C=URL.createObjectURL(W),G=void 0;if(i._features.forceBitmapOverHTMLImageElement)G=i.createImageBitmap(W,{premultiplyAlpha:"none"}).then(function(B){return $(B,i,o,u,C,U,h,s,f,l,e)});else{var L=new Image;L.src=C,G=new Promise(function(B,J){L.onload=function(){$(L,i,o,u,C,U,h,s,f,l,e).then(function(){return B()}).catch(function(z){J(z)})},L.onerror=function(z){J(z)}})}D.push(G)},E=0;E<6;E++)ee(E)},r=P.length>2&&P[2]!==void 0?P[2]:K,!oe.IsExponentOfTwo(e.width))throw new Error("Texture size must be a power of two");return n=ie(e.width)+1,i=e.getEngine(),o=!1,s=!1,u=null,l=null,f=null,c=i.getCaps(),e.format=5,e.type=0,e.generateMipMaps=!0,e._cachedAnisotropicFilteringLevel=null,i.updateTextureSamplingMode(3,e),c.textureLOD?i._features.supportRenderAndCopyToLodForFloatTextures?c.textureHalfFloatRender&&c.textureHalfFloatLinearFiltering?(o=!0,e.type=2):c.textureFloatRender&&c.textureFloatLinearFiltering&&(o=!0,e.type=1):o=!1:(o=!1,s=!0,f={}),b=0,o?i.isWebGPU?(b=1,[4,q(()=>import("./Dr010rql.js").then(h=>h.cW),__vite__mapDeps([0,1,2,3]),import.meta.url)]):[3,2]:[3,5];case 1:return w.sent(),[3,4];case 2:return[4,q(()=>import("./Dr010rql.js").then(h=>h.cV),__vite__mapDeps([0,1,2,3]),import.meta.url)];case 3:w.sent(),w.label=4;case 4:return u=new ae("rgbdDecode","rgbdDecode",null,null,1,null,3,i,!1,void 0,e.type,void 0,null,!1,void 0,b),e._isRGBD=!1,e.invertY=!1,l=i.createRenderTargetCubeTexture(e.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:e.type,format:5}),[3,6];case 5:if(e._isRGBD=!0,e.invertY=!0,s)for(g=3,v=e._lodGenerationScale,y=e._lodGenerationOffset,d=0;d<g;d++)switch(V=d/(g-1),H=1-V,S=y,I=(n-1)*v+y,Y=S+(I-S)*H,N=Math.round(Math.min(Math.max(Y,0),I)),_=new le(i,2),_.isCube=!0,_.invertY=!0,_.generateMipMaps=!1,i.updateTextureSamplingMode(2,_),m=new se(null),m._isCube=!0,m._texture=_,f[N]=m,d){case 0:e._lodTextureLow=m;break;case 1:e._lodTextureMid=m;break;case 2:e._lodTextureHigh=m;break}w.label=6;case 6:for(D=[],O=0;O<t.length;O++)a(O);if(t.length<n){switch(F=Math.pow(2,n-1-t.length),A=F*F*4,e.type){case 0:{T=new Uint8Array(A);break}case 2:{T=new Uint16Array(A);break}case 1:{T=new Float32Array(A);break}}for(R=t.length;R<n;R++)for(x=0;x<6;x++)i._uploadArrayBufferViewToTexture(e,T,x,R)}return[2,Promise.all(D).then(function(){l&&(i._releaseTexture(e),l._swapAndDie(e)),u&&u.dispose(),s&&(e._lodTextureHigh&&e._lodTextureHigh._texture&&(e._lodTextureHigh._texture.isReady=!0),e._lodTextureMid&&e._lodTextureMid._texture&&(e._lodTextureMid._texture.isReady=!0),e._lodTextureLow&&e._lodTextureLow._texture&&(e._lodTextureLow._texture.isReady=!0))})]}})}),k.apply(this,arguments)}function we(e,t){t=M(t);var a=t.irradiance;if(a){var r=new te;p.FromArrayToRef(a.x,0,r.x),p.FromArrayToRef(a.y,0,r.y),p.FromArrayToRef(a.z,0,r.z),p.FromArrayToRef(a.xx,0,r.xx),p.FromArrayToRef(a.yy,0,r.yy),p.FromArrayToRef(a.zz,0,r.zz),p.FromArrayToRef(a.yz,0,r.yz),p.FromArrayToRef(a.zx,0,r.zx),p.FromArrayToRef(a.xy,0,r.xy),e._sphericalPolynomial=r}}function Oe(e,t,a,r,n){var i=e.getEngine().createRawCubeTexture(null,e.width,e.format,e.type,e.generateMipMaps,e.invertY,e.samplingMode,e._compression),o=j(i,t).then(function(){return e});return e.onRebuildCallback=function(s){return{proxy:o,isReady:!0,isAsync:!0}},e._source=13,e._bufferViewArrayArray=t,e._lodGenerationScale=r,e._lodGenerationOffset=n,e._sphericalPolynomial=a,j(e,t).then(function(){return e.isReady=!0,e})}export{be as G,we as U,Oe as _,ve as a};
