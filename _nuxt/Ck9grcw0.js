import{cm as nr,cn as K,co as Sr,L as Er,cp as lr,cq as fr,cr as X,cs as ar,ct as Or,cu as Pr,cv as Lr,cw as Ar,cx as kr,cy as B,cz as dr,cA as F,T as Y,cB as W,cC as M,cD as Cr,cE as Ir,cF as ir,cG as zr,cH as Tr,cI as Ur}from"./CvXGGgpH.js";import"./CtRFD05V.js";function J(r,t){var a=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(!a){if(Array.isArray(r)||(a=yr(r))||t&&r&&typeof r.length=="number"){a&&(r=a);var o=0,v=function(){};return{s:v,n:function(){return o>=r.length?{done:!0}:{done:!1,value:r[o++]}},e:function(c){throw c},f:v}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var e,f=!0,u=!1;return{s:function(){a=a.call(r)},n:function(){var c=a.next();return f=c.done,c},e:function(c){u=!0,e=c},f:function(){try{f||a.return==null||a.return()}finally{if(u)throw e}}}}function yr(r,t){if(r){if(typeof r=="string")return Q(r,t);var a={}.toString.call(r).slice(8,-1);return a==="Object"&&r.constructor&&(a=r.constructor.name),a==="Map"||a==="Set"?Array.from(r):a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?Q(r,t):void 0}}function Q(r,t){(t==null||t>r.length)&&(t=r.length);for(var a=0,o=Array(t);a<t;a++)o[a]=r[a];return o}function R(r){"@babel/helpers - typeof";return R=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},R(r)}function N(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */N=function(){return t};var r,t={},a=Object.prototype,o=a.hasOwnProperty,v=Object.defineProperty||function(s,n,i){s[n]=i.value},e=typeof Symbol=="function"?Symbol:{},f=e.iterator||"@@iterator",u=e.asyncIterator||"@@asyncIterator",b=e.toStringTag||"@@toStringTag";function c(s,n,i){return Object.defineProperty(s,n,{value:i,enumerable:!0,configurable:!0,writable:!0}),s[n]}try{c({},"")}catch{c=function(i,p,y){return i[p]=y}}function m(s,n,i,p){var y=n&&n.prototype instanceof C?n:C,h=Object.create(y.prototype),E=new _(p||[]);return v(h,"_invoke",{value:pr(s,i,E)}),h}function O(s,n,i){try{return{type:"normal",arg:s.call(n,i)}}catch(p){return{type:"throw",arg:p}}}t.wrap=m;var L="suspendedStart",k="suspendedYield",w="executing",P="completed",S={};function C(){}function l(){}function g(){}var x={};c(x,f,function(){return this});var I=Object.getPrototypeOf,z=I&&I(I(H([])));z&&z!==a&&o.call(z,f)&&(x=z);var T=g.prototype=C.prototype=Object.create(x);function q(s){["next","throw","return"].forEach(function(n){c(s,n,function(i){return this._invoke(n,i)})})}function G(s,n){function i(y,h,E,A){var d=O(s[y],s,h);if(d.type!=="throw"){var D=d.arg,U=D.value;return U&&R(U)=="object"&&o.call(U,"__await")?n.resolve(U.__await).then(function(j){i("next",j,E,A)},function(j){i("throw",j,E,A)}):n.resolve(U).then(function(j){D.value=j,E(D)},function(j){return i("throw",j,E,A)})}A(d.arg)}var p;v(this,"_invoke",{value:function(h,E){function A(){return new n(function(d,D){i(h,E,d,D)})}return p=p?p.then(A,A):A()}})}function pr(s,n,i){var p=L;return function(y,h){if(p===w)throw Error("Generator is already running");if(p===P){if(y==="throw")throw h;return{value:r,done:!0}}for(i.method=y,i.arg=h;;){var E=i.delegate;if(E){var A=V(E,i);if(A){if(A===S)continue;return A}}if(i.method==="next")i.sent=i._sent=i.arg;else if(i.method==="throw"){if(p===L)throw p=P,i.arg;i.dispatchException(i.arg)}else i.method==="return"&&i.abrupt("return",i.arg);p=w;var d=O(s,n,i);if(d.type==="normal"){if(p=i.done?P:k,d.arg===S)continue;return{value:d.arg,done:i.done}}d.type==="throw"&&(p=P,i.method="throw",i.arg=d.arg)}}}function V(s,n){var i=n.method,p=s.iterator[i];if(p===r)return n.delegate=null,i==="throw"&&s.iterator.return&&(n.method="return",n.arg=r,V(s,n),n.method==="throw")||i!=="return"&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),S;var y=O(p,s.iterator,n.arg);if(y.type==="throw")return n.method="throw",n.arg=y.arg,n.delegate=null,S;var h=y.arg;return h?h.done?(n[s.resultName]=h.value,n.next=s.nextLoc,n.method!=="return"&&(n.method="next",n.arg=r),n.delegate=null,S):h:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function hr(s){var n={tryLoc:s[0]};1 in s&&(n.catchLoc=s[1]),2 in s&&(n.finallyLoc=s[2],n.afterLoc=s[3]),this.tryEntries.push(n)}function Z(s){var n=s.completion||{};n.type="normal",delete n.arg,s.completion=n}function _(s){this.tryEntries=[{tryLoc:"root"}],s.forEach(hr,this),this.reset(!0)}function H(s){if(s||s===""){var n=s[f];if(n)return n.call(s);if(typeof s.next=="function")return s;if(!isNaN(s.length)){var i=-1,p=function y(){for(;++i<s.length;)if(o.call(s,i))return y.value=s[i],y.done=!1,y;return y.value=r,y.done=!0,y};return p.next=p}}throw new TypeError(R(s)+" is not iterable")}return l.prototype=g,v(T,"constructor",{value:g,configurable:!0}),v(g,"constructor",{value:l,configurable:!0}),l.displayName=c(g,b,"GeneratorFunction"),t.isGeneratorFunction=function(s){var n=typeof s=="function"&&s.constructor;return!!n&&(n===l||(n.displayName||n.name)==="GeneratorFunction")},t.mark=function(s){return Object.setPrototypeOf?Object.setPrototypeOf(s,g):(s.__proto__=g,c(s,b,"GeneratorFunction")),s.prototype=Object.create(T),s},t.awrap=function(s){return{__await:s}},q(G.prototype),c(G.prototype,u,function(){return this}),t.AsyncIterator=G,t.async=function(s,n,i,p,y){y===void 0&&(y=Promise);var h=new G(m(s,n,i,p),y);return t.isGeneratorFunction(n)?h:h.next().then(function(E){return E.done?E.value:h.next()})},q(T),c(T,b,"Generator"),c(T,f,function(){return this}),c(T,"toString",function(){return"[object Generator]"}),t.keys=function(s){var n=Object(s),i=[];for(var p in n)i.push(p);return i.reverse(),function y(){for(;i.length;){var h=i.pop();if(h in n)return y.value=h,y.done=!1,y}return y.done=!0,y}},t.values=H,_.prototype={constructor:_,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(Z),!n)for(var i in this)i.charAt(0)==="t"&&o.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=r)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if(n.type==="throw")throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var i=this;function p(D,U){return E.type="throw",E.arg=n,i.next=D,U&&(i.method="next",i.arg=r),!!U}for(var y=this.tryEntries.length-1;y>=0;--y){var h=this.tryEntries[y],E=h.completion;if(h.tryLoc==="root")return p("end");if(h.tryLoc<=this.prev){var A=o.call(h,"catchLoc"),d=o.call(h,"finallyLoc");if(A&&d){if(this.prev<h.catchLoc)return p(h.catchLoc,!0);if(this.prev<h.finallyLoc)return p(h.finallyLoc)}else if(A){if(this.prev<h.catchLoc)return p(h.catchLoc,!0)}else{if(!d)throw Error("try statement without catch or finally");if(this.prev<h.finallyLoc)return p(h.finallyLoc)}}}},abrupt:function(n,i){for(var p=this.tryEntries.length-1;p>=0;--p){var y=this.tryEntries[p];if(y.tryLoc<=this.prev&&o.call(y,"finallyLoc")&&this.prev<y.finallyLoc){var h=y;break}}h&&(n==="break"||n==="continue")&&h.tryLoc<=i&&i<=h.finallyLoc&&(h=null);var E=h?h.completion:{};return E.type=n,E.arg=i,h?(this.method="next",this.next=h.finallyLoc,S):this.complete(E)},complete:function(n,i){if(n.type==="throw")throw n.arg;return n.type==="break"||n.type==="continue"?this.next=n.arg:n.type==="return"?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):n.type==="normal"&&i&&(this.next=i),S},finish:function(n){for(var i=this.tryEntries.length-1;i>=0;--i){var p=this.tryEntries[i];if(p.finallyLoc===n)return this.complete(p.completion,p.afterLoc),Z(p),S}},catch:function(n){for(var i=this.tryEntries.length-1;i>=0;--i){var p=this.tryEntries[i];if(p.tryLoc===n){var y=p.completion;if(y.type==="throw"){var h=y.arg;Z(p)}return h}}throw Error("illegal catch attempt")},delegateYield:function(n,i,p){return this.delegate={iterator:H(n),resultName:i,nextLoc:p},this.method==="next"&&(this.arg=r),S}},t}function vr(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}function rr(r,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(r,ur(o.key),o)}}function br(r,t,a){return t&&rr(r.prototype,t),a&&rr(r,a),Object.defineProperty(r,"prototype",{writable:!1}),r}function er(r,t,a,o,v,e,f){try{var u=r[e](f),b=u.value}catch(c){return void a(c)}u.done?t(b):Promise.resolve(b).then(o,v)}function sr(r){return function(){var t=this,a=arguments;return new Promise(function(o,v){var e=r.apply(t,a);function f(b){er(e,o,v,f,u,"next",b)}function u(b){er(e,o,v,f,u,"throw",b)}f(void 0)})}}function tr(r,t){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(r);t&&(o=o.filter(function(v){return Object.getOwnPropertyDescriptor(r,v).enumerable})),a.push.apply(a,o)}return a}function mr(r){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?tr(Object(a),!0).forEach(function(o){wr(r,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):tr(Object(a)).forEach(function(o){Object.defineProperty(r,o,Object.getOwnPropertyDescriptor(a,o))})}return r}function wr(r,t,a){return(t=ur(t))in r?Object.defineProperty(r,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[t]=a,r}function ur(r){var t=gr(r,"string");return R(t)=="symbol"?t:t+""}function gr(r,t){if(R(r)!="object"||!r)return r;var a=r[Symbol.toPrimitive];if(a!==void 0){var o=a.call(r,t||"default");if(R(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(r)}var xr=20000630;function Dr(r,t){if(r.getUint32(0,!0)!=xr)throw new Error("Incorrect OpenEXR format");var a=r.getUint8(4),o=r.getUint8(5),v={singleTile:!!(o&2),longName:!!(o&4),deepFormat:!!(o&8),multiPart:!!(o&16)};t.value=8;for(var e={},f=!0;f;){var u=nr(r.buffer,t);if(!u)f=!1;else{var b=nr(r.buffer,t),c=K(r,t),m=Sr(r,t,b,c);m===void 0?Er.Warn("Unknown header attribute type ".concat(b,"'.")):e[u]=m}}if(o&-5)throw new Error("Unsupported file format");return mr({version:a,spec:v},e)}function jr(r){for(var t=r.byteLength,a=new Array,o=0,v=new DataView(r);t>0;){var e=v.getInt8(o++);if(e<0){var f=-e;t-=f+1;for(var u=0;u<f;u++)a.push(v.getUint8(o++))}else{var b=e;t-=2;for(var c=v.getUint8(o++),m=0;m<b+1;m++)a.push(c)}}return a}function cr(r){return new DataView(r.array.buffer,r.offset.value,r.size)}function Fr(r){var t=r.viewer.buffer.slice(r.offset.value,r.offset.value+r.size),a=new Uint8Array(jr(t)),o=new Uint8Array(a.length);return lr(a),fr(a,o),new DataView(o.buffer)}function or(r){var t=r.array.slice(r.offset.value,r.offset.value+r.size),a=fflate.unzlibSync(t),o=new Uint8Array(a.length);return lr(a),fr(a,o),new DataView(o.buffer)}function Rr(r){for(var t=r.array.slice(r.offset.value,r.offset.value+r.size),a=fflate.unzlibSync(t),o=r.lines*r.channels*r.width,v=r.type==1?new Uint16Array(o):new Uint32Array(o),e=0,f=0,u=new Array(4),b=0;b<r.lines;b++)for(var c=0;c<r.channels;c++){var m=0;switch(r.type){case 1:u[0]=e,u[1]=u[0]+r.width,e=u[1]+r.width;for(var O=0;O<r.width;++O){var L=a[u[0]++]<<8|a[u[1]++];m+=L,v[f]=m,f++}break;case 2:u[0]=e,u[1]=u[0]+r.width,u[2]=u[1]+r.width,e=u[2]+r.width;for(var k=0;k<r.width;++k){var w=a[u[0]++]<<24|a[u[1]++]<<16|a[u[2]++]<<8;m+=w,v[f]=m,f++}break}}return new DataView(v.buffer)}function Mr(r){for(var t=r.viewer,a={value:r.offset.value},o=new Uint16Array(r.width*r.scanlineBlockSize*(r.channels*r.type)),v=new Uint8Array(ar),e=0,f=new Array(r.channels),u=0;u<r.channels;u++)f[u]={},f[u].start=e,f[u].end=f[u].start,f[u].nx=r.width,f[u].ny=r.lines,f[u].size=r.type,e+=f[u].nx*f[u].ny*f[u].size;var b=X(t,a),c=X(t,a);if(c>=ar)throw new Error("Wrong PIZ_COMPRESSION BITMAP_SIZE");if(b<=c)for(var m=0;m<c-b+1;m++)v[m+b]=Or(t,a);var O=new Uint16Array(dr),L=Pr(v,O),k=K(t,a);Lr(r.array,t,a,k,o,e);for(var w=0;w<r.channels;++w)for(var P=f[w],S=0;S<f[w].size;++S)Ar(o,P.start+S,P.nx,P.size,P.ny,P.nx*P.size,L);kr(O,o,e);for(var C=0,l=new Uint8Array(o.buffer.byteLength),g=0;g<r.lines;g++)for(var x=0;x<r.channels;x++){var I=f[x],z=I.nx*I.size,T=new Uint8Array(o.buffer,I.end*B,z*B);l.set(T,C),C+=z*B,I.end+=z}return new DataView(l.buffer)}function Br(r,t,a,o){return $.apply(this,arguments)}function $(){return $=sr(N().mark(function r(t,a,o,v){var e,f,u,b,c,m,O,L,k,w,P,S;return N().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:e={size:0,viewer:a,array:new Uint8Array(a.buffer),offset:o,width:t.dataWindow.xMax-t.dataWindow.xMin+1,height:t.dataWindow.yMax-t.dataWindow.yMin+1,channels:t.channels.length,channelLineOffsets:{},scanOrder:function(){return 0},bytesPerLine:0,outLineWidth:0,lines:0,scanlineBlockSize:0,inputSize:null,type:0,uncompress:null,getter:function(){return 0},format:5,outputChannels:0,decodeChannels:{},blockCount:null,byteArray:null,linearSpace:!1,textureType:0},l.t0=t.compression,l.next=l.t0===F.NO_COMPRESSION?4:l.t0===F.RLE_COMPRESSION?7:l.t0===F.ZIPS_COMPRESSION?10:l.t0===F.ZIP_COMPRESSION?15:l.t0===F.PIZ_COMPRESSION?20:l.t0===F.PXR24_COMPRESSION?23:28;break;case 4:return e.lines=1,e.uncompress=cr,l.abrupt("break",29);case 7:return e.lines=1,e.uncompress=Fr,l.abrupt("break",29);case 10:return e.lines=1,e.uncompress=or,l.next=14,Y.LoadScriptAsync(W.FFLATEUrl);case 14:return l.abrupt("break",29);case 15:return e.lines=16,e.uncompress=or,l.next=19,Y.LoadScriptAsync(W.FFLATEUrl);case 19:return l.abrupt("break",29);case 20:return e.lines=32,e.uncompress=Mr,l.abrupt("break",29);case 23:return e.lines=16,e.uncompress=Rr,l.next=27,Y.LoadScriptAsync(W.FFLATEUrl);case 27:return l.abrupt("break",29);case 28:throw new Error(F[t.compression]+" is unsupported");case 29:e.scanlineBlockSize=e.lines,f={},u=J(t.channels);try{for(u.s();!(b=u.n()).done;)switch(c=b.value,c.name){case"Y":case"R":case"G":case"B":case"A":f[c.name]=!0,e.type=c.pixelType}}catch(g){u.e(g)}finally{u.f()}if(m=!1,!(f.R&&f.G&&f.B)){l.next=40;break}m=!f.A,e.outputChannels=4,e.decodeChannels={R:0,G:1,B:2,A:3},l.next=46;break;case 40:if(!f.Y){l.next=45;break}e.outputChannels=1,e.decodeChannels={Y:0},l.next=46;break;case 45:throw new Error("EXRLoader.parse: file contains unsupported data channels.");case 46:if(e.type!==1){l.next=58;break}l.t1=v,l.next=l.t1===M.Float?50:l.t1===M.HalfFloat?53:56;break;case 50:return e.getter=Cr,e.inputSize=B,l.abrupt("break",56);case 53:return e.getter=X,e.inputSize=B,l.abrupt("break",56);case 56:l.next=70;break;case 58:if(e.type!==2){l.next=69;break}l.t2=v,l.next=l.t2===M.Float?62:l.t2===M.HalfFloat?65:67;break;case 62:return e.getter=zr,e.inputSize=ir,l.abrupt("break",67);case 65:e.getter=Ir,e.inputSize=ir;case 67:l.next=70;break;case 69:throw new Error("Unsupported pixelType "+e.type+" for "+t.compression);case 70:for(e.blockCount=e.height/e.scanlineBlockSize,O=0;O<e.blockCount;O++)Tr(a,o);L=e.width*e.height*e.outputChannels,l.t3=v,l.next=l.t3===M.Float?76:l.t3===M.HalfFloat?80:84;break;case 76:return e.byteArray=new Float32Array(L),e.textureType=1,m&&e.byteArray.fill(1,0,L),l.abrupt("break",85);case 80:return e.byteArray=new Uint16Array(L),e.textureType=2,m&&e.byteArray.fill(15360,0,L),l.abrupt("break",85);case 84:throw new Error("Unsupported type: "+v);case 85:k=0,w=J(t.channels);try{for(w.s();!(P=w.n()).done;)S=P.value,e.decodeChannels[S.name]!==void 0&&(e.channelLineOffsets[S.name]=k*e.width),k+=S.pixelType*2}catch(g){w.e(g)}finally{w.f()}return e.bytesPerLine=e.width*k,e.outLineWidth=e.width*e.outputChannels,t.lineOrder==="INCREASING_Y"?e.scanOrder=function(g){return g}:e.scanOrder=function(g){return e.height-1-g},e.outputChannels==4?(e.format=5,e.linearSpace=!0):(e.format=6,e.linearSpace=!1),l.abrupt("return",e);case 93:case"end":return l.stop()}},r)})),$.apply(this,arguments)}function Nr(r,t,a,o){for(var v={value:0},e=0;e<r.height/r.scanlineBlockSize;e++){var f=Ur(a,o)-t.dataWindow.yMin;r.size=K(a,o),r.lines=f+r.scanlineBlockSize>r.height?r.height-f:r.scanlineBlockSize;var u=r.size<r.lines*r.bytesPerLine,b=u&&r.uncompress?r.uncompress(r):cr(r);o.value+=r.size;for(var c=0;c<r.scanlineBlockSize;c++){var m=e*r.scanlineBlockSize,O=c+r.scanOrder(m);if(!(O>=r.height))for(var L=c*r.bytesPerLine,k=(r.height-1-O)*r.outLineWidth,w=0;w<r.channels;w++){var P=t.channels[w].name,S=r.channelLineOffsets[P],C=r.decodeChannels[P];if(C!==void 0){v.value=L+S;for(var l=0;l<r.width;l++){var g=k+l*r.outputChannels+C;r.byteArray&&(r.byteArray[g]=r.getter(b,v))}}}}}}var Zr=function(){function r(){vr(this,r),this.supportCascades=!1}return br(r,[{key:"loadCubeData",value:function(a,o,v,e,f){throw".exr not supported in Cube."}},{key:"loadData",value:function(){var t=sr(N().mark(function o(v,e,f){var u,b,c,m,O,L;return N().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return u=new DataView(v.buffer),b={value:0},c=Dr(u,b),w.next=5,Br(c,u,b,W.DefaultOutputType);case 5:m=w.sent,Nr(m,c,u,b),O=c.dataWindow.xMax-c.dataWindow.xMin+1,L=c.dataWindow.yMax-c.dataWindow.yMin+1,f(O,L,e.generateMipMaps,!1,function(){var P=e.getEngine();e.format=c.format,e.type=m.textureType,e.invertY=!1,e._gammaSpace=!c.linearSpace,m.byteArray&&P._uploadDataToTextureDirectly(e,m.byteArray,0,0,void 0,!0)});case 10:case"end":return w.stop()}},o)}));function a(o,v,e){return t.apply(this,arguments)}return a}()}])}();export{Zr as _ExrTextureLoader};
