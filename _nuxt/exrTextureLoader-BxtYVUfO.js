import{N as R,O as I,W as G,w as X,X as N,Y as W,Z as L,_ as T,$ as H,a0 as Y,a1 as $,a2 as V,a3 as q,a4 as z,a5 as J,a6 as Q,a7 as P,v as x,a8 as U,a9 as C,aa as j,ab as K,ac as B,ad as d,ae as ee}from"./VGRWorker-Ds2QV2D2.js";function re(r,u,s){return u in r?Object.defineProperty(r,u,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[u]=s,r}function ne(r){for(var u=1;u<arguments.length;u++){var s=arguments[u]!=null?arguments[u]:{},n=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(s).filter(function(e){return Object.getOwnPropertyDescriptor(s,e).enumerable}))),n.forEach(function(e){re(r,e,s[e])})}return r}var te=20000630;function ae(r,u){if(r.getUint32(0,!0)!=te)throw new Error("Incorrect OpenEXR format");var s=r.getUint8(4),n=r.getUint8(5),e={singleTile:!!(n&2),longName:!!(n&4),deepFormat:!!(n&8),multiPart:!!(n&16)};u.value=8;for(var l={},t=!0;t;){var i=R(r.buffer,u);if(!i)t=!1;else{var f=R(r.buffer,u),a=I(r,u),o=G(r,u,f,a);o===void 0?X.Warn("Unknown header attribute type ".concat(f,"'.")):l[i]=o}}if(n&-5)throw new Error("Unsupported file format");return ne({version:s,spec:e},l)}function ie(r){for(var u=r.byteLength,s=new Array,n=0,e=new DataView(r);u>0;){var l=e.getInt8(n++);if(l<0){var t=-l;u-=t+1;for(var i=0;i<t;i++)s.push(e.getUint8(n++))}else{var f=l;u-=2;for(var a=e.getUint8(n++),o=0;o<f+1;o++)s.push(a)}}return s}function Z(r){return new DataView(r.array.buffer,r.offset.value,r.size)}function se(r){var u=r.viewer.buffer.slice(r.offset.value,r.offset.value+r.size),s=new Uint8Array(ie(u)),n=new Uint8Array(s.length);return N(s),W(s,n),new DataView(n.buffer)}function D(r){var u=r.array.slice(r.offset.value,r.offset.value+r.size),s=fflate.unzlibSync(u),n=new Uint8Array(s.length);return N(s),W(s,n),new DataView(n.buffer)}function ue(r){for(var u=r.array.slice(r.offset.value,r.offset.value+r.size),s=fflate.unzlibSync(u),n=r.lines*r.channels*r.width,e=r.type==1?new Uint16Array(n):new Uint32Array(n),l=0,t=0,i=new Array(4),f=0;f<r.lines;f++)for(var a=0;a<r.channels;a++){var o=0;switch(r.type){case 1:i[0]=l,i[1]=i[0]+r.width,l=i[1]+r.width;for(var h=0;h<r.width;++h){var y=s[i[0]++]<<8|s[i[1]++];o+=y,e[t]=o,t++}break;case 2:i[0]=l,i[1]=i[0]+r.width,i[2]=i[1]+r.width,l=i[2]+r.width;for(var w=0;w<r.width;++w){var v=s[i[0]++]<<24|s[i[1]++]<<16|s[i[2]++]<<8;o+=v,e[t]=o,t++}break}}return new DataView(e.buffer)}function le(r){for(var u=r.viewer,s={value:r.offset.value},n=new Uint16Array(r.width*r.scanlineBlockSize*(r.channels*r.type)),e=new Uint8Array(T),l=0,t=new Array(r.channels),i=0;i<r.channels;i++)t[i]={},t[i].start=l,t[i].end=t[i].start,t[i].nx=r.width,t[i].ny=r.lines,t[i].size=r.type,l+=t[i].nx*t[i].ny*t[i].size;var f=L(u,s),a=L(u,s);if(a>=T)throw new Error("Wrong PIZ_COMPRESSION BITMAP_SIZE");if(f<=a)for(var o=0;o<a-f+1;o++)e[o+f]=H(u,s);var h=new Uint16Array(J),y=Y(e,h),w=I(u,s);$(r.array,u,s,w,n,l);for(var v=0;v<r.channels;++v)for(var c=t[v],p=0;p<t[v].size;++p)V(n,c.start+p,c.nx,c.size,c.ny,c.nx*c.size,y);q(h,n,l);for(var b=0,m=new Uint8Array(n.buffer.byteLength),g=0;g<r.lines;g++)for(var S=0;S<r.channels;S++){var A=t[S],_=A.nx*A.size,O=new Uint8Array(n.buffer,A.end*z,_*z);m.set(O,b),b+=_*z,A.end+=_}return new DataView(m.buffer)}function M(r,u,s,n,e,l,t){try{var i=r[l](t),f=i.value}catch(a){s(a);return}i.done?u(f):Promise.resolve(f).then(n,e)}function fe(r){return function(){var u=this,s=arguments;return new Promise(function(n,e){var l=r.apply(u,s);function t(f){M(l,n,e,t,i,"next",f)}function i(f){M(l,n,e,t,i,"throw",f)}t(void 0)})}}function oe(r,u){var s,n,e,l,t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]};return l={next:i(0),throw:i(1),return:i(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function i(a){return function(o){return f([a,o])}}function f(a){if(s)throw new TypeError("Generator is already executing.");for(;t;)try{if(s=1,n&&(e=a[0]&2?n.return:a[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,a[1])).done)return e;switch(n=0,e&&(a=[a[0]&2,e.value]),a[0]){case 0:case 1:e=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,n=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!e||a[1]>e[0]&&a[1]<e[3])){t.label=a[1];break}if(a[0]===6&&t.label<e[1]){t.label=e[1],e=a;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(a);break}e[2]&&t.ops.pop(),t.trys.pop();continue}a=u.call(r,t)}catch(o){a=[6,o],n=0}finally{s=e=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}function ce(r,u,s,n){return k.apply(this,arguments)}function k(){return k=fe(function(r,u,s,n){var e,l,t,i,f,a,o,h,y,w,v,c,p,b,m,g,S,A,_;return oe(this,function(O){switch(O.label){case 0:switch(e={size:0,viewer:u,array:new Uint8Array(u.buffer),offset:s,width:r.dataWindow.xMax-r.dataWindow.xMin+1,height:r.dataWindow.yMax-r.dataWindow.yMin+1,channels:r.channels.length,channelLineOffsets:{},scanOrder:function(){return 0},bytesPerLine:0,outLineWidth:0,lines:0,scanlineBlockSize:0,inputSize:null,type:0,uncompress:null,getter:function(){return 0},format:5,outputChannels:0,decodeChannels:{},blockCount:null,byteArray:null,linearSpace:!1,textureType:0},l=r.compression,l){case P.NO_COMPRESSION:return[3,1];case P.RLE_COMPRESSION:return[3,2];case P.ZIPS_COMPRESSION:return[3,3];case P.ZIP_COMPRESSION:return[3,5];case P.PIZ_COMPRESSION:return[3,7];case P.PXR24_COMPRESSION:return[3,8]}return[3,10];case 1:return e.lines=1,e.uncompress=Z,[3,11];case 2:return e.lines=1,e.uncompress=se,[3,11];case 3:return e.lines=1,e.uncompress=D,[4,x.LoadScriptAsync(U.FFLATEUrl)];case 4:return O.sent(),[3,11];case 5:return e.lines=16,e.uncompress=D,[4,x.LoadScriptAsync(U.FFLATEUrl)];case 6:return O.sent(),[3,11];case 7:return e.lines=32,e.uncompress=le,[3,11];case 8:return e.lines=16,e.uncompress=ue,[4,x.LoadScriptAsync(U.FFLATEUrl)];case 9:return O.sent(),[3,11];case 10:throw new Error(P[r.compression]+" is unsupported");case 11:e.scanlineBlockSize=e.lines,t={},i=!0,f=!1,a=void 0;try{for(o=r.channels[Symbol.iterator]();!(i=(h=o.next()).done);i=!0)switch(y=h.value,y.name){case"Y":case"R":case"G":case"B":case"A":t[y.name]=!0,e.type=y.pixelType}}catch(E){f=!0,a=E}finally{try{!i&&o.return!=null&&o.return()}finally{if(f)throw a}}if(w=!1,t.R&&t.G&&t.B)w=!t.A,e.outputChannels=4,e.decodeChannels={R:0,G:1,B:2,A:3};else if(t.Y)e.outputChannels=1,e.decodeChannels={Y:0};else throw new Error("EXRLoader.parse: file contains unsupported data channels.");if(e.type===1)switch(n){case C.Float:e.getter=j,e.inputSize=z;break;case C.HalfFloat:e.getter=L,e.inputSize=z;break}else if(e.type===2)switch(n){case C.Float:e.getter=d,e.inputSize=B;break;case C.HalfFloat:e.getter=K,e.inputSize=B}else throw new Error("Unsupported pixelType "+e.type+" for "+r.compression);for(e.blockCount=e.height/e.scanlineBlockSize,v=0;v<e.blockCount;v++)ee(u,s);switch(c=e.width*e.height*e.outputChannels,n){case C.Float:e.byteArray=new Float32Array(c),e.textureType=1,w&&e.byteArray.fill(1,0,c);break;case C.HalfFloat:e.byteArray=new Uint16Array(c),e.textureType=2,w&&e.byteArray.fill(15360,0,c);break;default:throw new Error("Unsupported type: "+n)}p=0,b=!0,m=!1,g=void 0;try{for(S=r.channels[Symbol.iterator]();!(b=(A=S.next()).done);b=!0)_=A.value,e.decodeChannels[_.name]!==void 0&&(e.channelLineOffsets[_.name]=p*e.width),p+=_.pixelType*2}catch(E){m=!0,g=E}finally{try{!b&&S.return!=null&&S.return()}finally{if(m)throw g}}return e.bytesPerLine=e.width*p,e.outLineWidth=e.width*e.outputChannels,r.lineOrder==="INCREASING_Y"?e.scanOrder=function(E){return E}:e.scanOrder=function(E){return e.height-1-E},e.outputChannels==4?(e.format=5,e.linearSpace=!0):(e.format=6,e.linearSpace=!1),[2,e]}})}),k.apply(this,arguments)}function he(r,u,s,n){for(var e={value:0},l=0;l<r.height/r.scanlineBlockSize;l++){var t=Q(s,n)-u.dataWindow.yMin;r.size=I(s,n),r.lines=t+r.scanlineBlockSize>r.height?r.height-t:r.scanlineBlockSize;var i=r.size<r.lines*r.bytesPerLine,f=i&&r.uncompress?r.uncompress(r):Z(r);n.value+=r.size;for(var a=0;a<r.scanlineBlockSize;a++){var o=l*r.scanlineBlockSize,h=a+r.scanOrder(o);if(!(h>=r.height))for(var y=a*r.bytesPerLine,w=(r.height-1-h)*r.outLineWidth,v=0;v<r.channels;v++){var c=u.channels[v].name,p=r.channelLineOffsets[c],b=r.decodeChannels[c];if(b!==void 0){e.value=y+p;for(var m=0;m<r.width;m++){var g=w+m*r.outputChannels+b;r.byteArray&&(r.byteArray[g]=r.getter(f,e))}}}}}}function F(r,u,s,n,e,l,t){try{var i=r[l](t),f=i.value}catch(a){s(a);return}i.done?u(f):Promise.resolve(f).then(n,e)}function ve(r){return function(){var u=this,s=arguments;return new Promise(function(n,e){var l=r.apply(u,s);function t(f){F(l,n,e,t,i,"next",f)}function i(f){F(l,n,e,t,i,"throw",f)}t(void 0)})}}function ye(r,u){if(!(r instanceof u))throw new TypeError("Cannot call a class as a function")}function we(r,u){for(var s=0;s<u.length;s++){var n=u[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function pe(r,u,s){return we(r.prototype,u),r}function be(r,u){var s,n,e,l,t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]};return l={next:i(0),throw:i(1),return:i(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function i(a){return function(o){return f([a,o])}}function f(a){if(s)throw new TypeError("Generator is already executing.");for(;t;)try{if(s=1,n&&(e=a[0]&2?n.return:a[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,a[1])).done)return e;switch(n=0,e&&(a=[a[0]&2,e.value]),a[0]){case 0:case 1:e=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,n=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!e||a[1]>e[0]&&a[1]<e[3])){t.label=a[1];break}if(a[0]===6&&t.label<e[1]){t.label=e[1],e=a;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(a);break}e[2]&&t.ops.pop(),t.trys.pop();continue}a=u.call(r,t)}catch(o){a=[6,o],n=0}finally{s=e=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}var ge=function(){function r(){ye(this,r),this.supportCascades=!1}return pe(r,[{key:"loadCubeData",value:function(s,n,e,l,t){throw".exr not supported in Cube."}},{key:"loadData",value:function(s,n,e){return ve(function(){var l,t,i,f,a,o;return be(this,function(h){switch(h.label){case 0:return l=new DataView(s.buffer),t={value:0},i=ae(l,t),[4,ce(i,l,t,U.DefaultOutputType)];case 1:return f=h.sent(),he(f,i,l,t),a=i.dataWindow.xMax-i.dataWindow.xMin+1,o=i.dataWindow.yMax-i.dataWindow.yMin+1,e(a,o,n.generateMipMaps,!1,function(){var y=n.getEngine();n.format=i.format,n.type=f.textureType,n.invertY=!1,n._gammaSpace=!i.linearSpace,f.byteArray&&y._uploadDataToTextureDirectly(n,f.byteArray,0,0,void 0,!0)}),[2]}})})()}}]),r}();export{ge as _ExrTextureLoader};
